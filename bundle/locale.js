// http://www.loc.gov/standards/iso639-2/php/code_list.php
var bcp47iso639 = {
    'aar': 'aa', // Afar
    'abk': 'ab', // Abkhazian
    'afr': 'af', // Afrikaans
    'aka': 'ak', // Akan
    'alb': 'sq', // Albanian
    'sqi': 'sq', // Albanian
    'amh': 'am', // Amharic
    'ara': 'ar', // Arabic
    'arg': 'an', // Aragonese
    'arm': 'hy', // Armenian
    'hye': 'hy', // Armenian
    'asm': 'as', // Assamese
    'ava': 'av', // Avaric
    'ave': 'ae', // Avestan
    'aym': 'ay', // Aymara
    'aze': 'az', // Azerbaijani
    'bak': 'ba', // Bashkir
    'bam': 'bm', // Bambara
    'baq': 'eu', // Basque
    'eus': 'eu', // Basque
    'bel': 'be', // Belarusian
    'ben': 'bn', // Bengali
    'bih': 'bh', // Bihari languages
    'bis': 'bi', // Bislama
    'tib': 'bo', // Tibetan
    'bod': 'bo', // Tibetan
    'bos': 'bs', // Bosnian
    'bre': 'br', // Breton
    'bul': 'bg', // Bulgarian
    'bur': 'my', // Burmese
    'mya': 'my', // Burmese
    'cat': 'ca', // Catalan; Valencian
    'cze': 'cs', // Czech
    'ces': 'cs', // Czech
    'cha': 'ch', // Chamorro
    'che': 'ce', // Chechen
    'chi': 'zh', // Chinese
    'zho': 'zh', // Chinese
    'chu': 'cu', // Church Slavic; Old Slavonic/Bulgarian
    'chv': 'cv', // Chuvash
    'cor': 'kw', // Cornish
    'cos': 'co', // Corsican
    'cre': 'cr', // Cree
    'wel': 'cy', // Welsh
    'cym': 'cy', // Welsh
    'dan': 'da', // Danish
    'ger': 'de', // German
    'deu': 'de', // German
    'div': 'dv', // Divehi; Dhivehi; Maldivian
    'dut': 'nl', // Dutch; Flemish
    'nld': 'nl', // Dutch; Flemish
    'dzo': 'dz', // Dzongkha
    'gre': 'el', // Greek, Modern (1453-)
    'ell': 'el', // Greek, Modern (1453-)
    'eng': 'en', // English
    'epo': 'eo', // Esperanto
    'est': 'et', // Estonian
    'ewe': 'ee', // Ewe
    'fao': 'fo', // Faroese
    'per': 'fa', // Persian
    'fas': 'fa', // Persian
    'fij': 'fj', // Fijian
    'fin': 'fi', // Finnish
    'fre': 'fr', // French
    'fra': 'fr', // French
    'fry': 'fy', // Western Frisian
    'ful': 'ff', // Fulah
    'geo': 'ka', // Georgian
    'kat': 'ka', // Georgian
    'gla': 'gd', // Gaelic; Scottish Gaelic
    'gle': 'ga', // Irish
    'glg': 'gl', // Galician
    'glv': 'gv', // Manx
    'grn': 'gn', // Guarani
    'guj': 'gu', // Gujarati
    'hat': 'ht', // Haitian; Haitian Creole
    'hau': 'ha', // Hausa
    'heb': 'he', // Hebrew
    'her': 'hz', // Herero
    'hin': 'hi', // Hindi
    'hmo': 'ho', // Hiri Motu
    'hrv': 'hr', // Croatian
    'hun': 'hu', // Hungarian
    'ibo': 'ig', // Igbo
    'ice': 'is', // Icelandic
    'isl': 'is', // Icelandic
    'ido': 'io', // Ido
    'iii': 'ii', // Sichuan Yi; Nuosu
    'iku': 'iu', // Inuktitut
    'ind': 'id', // Indonesian
    'ipk': 'ik', // Inupiaq
    'ita': 'it', // Italian
    'jav': 'jv', // Javanese
    'jpn': 'ja', // Japanese
    'kal': 'kl', // Kalaallisut; Greenlandic
    'kan': 'kn', // Kannada
    'kas': 'ks', // Kashmiri
    'kau': 'kr', // Kanuri
    'kaz': 'kk', // Kazakh
    'khm': 'km', // Central Khmer
    'kik': 'ki', // Kikuyu; Gikuyu
    'kin': 'rw', // Kinyarwanda
    'kir': 'ky', // Kirghiz; Kyrgyz
    'kom': 'kv', // Komi
    'kon': 'kg', // Kongo
    'kor': 'ko', // Korean
    'kua': 'kj', // Kuanyama; Kwanyama
    'kur': 'ku', // Kurdish
    'lao': 'lo', // Lao
    'lat': 'la', // Latin
    'lav': 'lv', // Latvian
    'lim': 'li', // Limburgan; Limburger; Limburgish
    'lin': 'ln', // Lingala
    'lit': 'lt', // Lithuanian
    'ltz': 'lb', // Luxembourgish; Letzeburgesch
    'lub': 'lu', // Luba-Katanga
    'lug': 'lg', // Ganda
    'mac': 'mk', // Macedonian
    'mkd': 'mk', // Macedonian
    'mah': 'mh', // Marshallese
    'mal': 'ml', // Malayalam
    'mao': 'mi', // Maori
    'mri': 'mi', // Maori
    'mar': 'mr', // Marathi
    'may': 'ms', // Malay
    'msa': 'ms', // Malay
    'mlg': 'mg', // Malagasy
    'mlt': 'mt', // Maltese
    'mon': 'mn', // Mongolian
    'nau': 'na', // Nauru
    'nav': 'nv', // Navajo; Navaho
    'nbl': 'nr', // Ndebele, South; South Ndebele
    'nde': 'nd', // Ndebele, North; North Ndebele
    'ndo': 'ng', // Ndonga
    'nep': 'ne', // Nepali
    'nno': 'nn', // Norwegian Nynorsk; Nynorsk, Norwegian
    'nob': 'nb', // Bokmal, Norwegian; Norwegian Bokmal
    'nor': 'no', // Norwegian
    'nya': 'ny', // Chichewa; Chewa; Nyanja
    'oci': 'oc', // Occitan (post 1500)
    'oji': 'oj', // Ojibwa
    'ori': 'or', // Oriya
    'orm': 'om', // Oromo
    'oss': 'os', // Ossetian; Ossetic
    'pan': 'pa', // Panjabi; Punjabi
    'pli': 'pi', // Pali
    'pol': 'pl', // Polish
    'por': 'pt', // Portuguese
    'pus': 'ps', // Pushto; Pashto
    'que': 'qu', // Quechua
    'roh': 'rm', // Romansh
    'rum': 'ro', // Romanian; Moldavian; Moldovan
    'ron': 'ro', // Romanian; Moldavian; Moldovan
    'run': 'rn', // Rundi
    'rus': 'ru', // Russian
    'sag': 'sg', // Sango
    'san': 'sa', // Sanskrit
    'sin': 'si', // Sinhala; Sinhalese
    'slo': 'sk', // Slovak
    'slk': 'sk', // Slovak
    'slv': 'sl', // Slovenian
    'sme': 'se', // Northern Sami
    'smo': 'sm', // Samoan
    'sna': 'sn', // Shona
    'snd': 'sd', // Sindhi
    'som': 'so', // Somali
    'sot': 'st', // Sotho, Southern
    'spa': 'es', // Spanish; Castilian
    'srd': 'sc', // Sardinian
    'srp': 'sr', // Serbian
    'ssw': 'ss', // Swati
    'sun': 'su', // Sundanese
    'swa': 'sw', // Swahili
    'swe': 'sv', // Swedish
    'tah': 'ty', // Tahitian
    'tam': 'ta', // Tamil
    'tat': 'tt', // Tatar
    'tel': 'te', // Telugu
    'tgk': 'tg', // Tajik
    'tgl': 'tl', // Tagalog
    'tha': 'th', // Thai
    'tir': 'ti', // Tigrinya
    'ton': 'to', // Tonga (Tonga Islands)
    'tsn': 'tn', // Tswana
    'tso': 'ts', // Tsonga
    'tuk': 'tk', // Turkmen
    'tur': 'tr', // Turkish
    'twi': 'tw', // Twi
    'uig': 'ug', // Uighur; Uyghur
    'ukr': 'uk', // Ukrainian
    'urd': 'ur', // Urdu
    'uzb': 'uz', // Uzbek
    'ven': 've', // Venda
    'vie': 'vi', // Vietnamese
    'vol': 'vo', // Volapuk
    'wln': 'wa', // Walloon
    'wol': 'wo', // Wolof
    'xho': 'xh', // Xhosa
    'yid': 'yi', // Yiddish
    'yor': 'yo', // Yoruba
    'zha': 'za', // Zhuang; Chuang
    'zul': 'zu', // Zulu
};

var ns = Object.create(null);

lazy(ns, 'lang', function() {
    return String(localStorage.vslang || navigator.language || mega.intl.locale).split('-')[0] || 'en';
});

ns.decodeMP4LangCode = function(code) {
    return String.fromCharCode.apply(null, [96 + ((code >> 10) & 31), 96 + ((code >> 5) & 31), 96 + (code & 31)]);
};

ns.bcp47match = function(lang) {
    if (typeof lang === 'number') {
        lang = ns.decodeMP4LangCode(lang);
    }

    lang = bcp47iso639[lang];
    if (lang && lang === (localStorage.vslang || $.vslang)) {
        // user-overridden lang
        return lang;
    }

    var locales = ['nn-' + mega.ipcc, mega.intl.locale, navigator.language].concat(navigator.languages);
    for (var i = 0; i < locales.length; ++i) {
        var locale = String(locales[i]).split('-');
        if (locale[1] && String(locale[1]).toLowerCase() === lang) {
            // lang as per user country
            return lang;
        }
        if (lang && lang === locale[0]) {
            // lang as per UI/browser locale
            return lang;
        }
    }
    return false;
};

module.exports = ns;
